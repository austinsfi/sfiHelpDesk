<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Slack Alerter & Messenger</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  }
Â  Â  Â  Â  .message {
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  transform: translateY(20px);
Â  Â  Â  Â  Â  Â  animation: fadeIn 0.5s forwards;
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes fadeIn {
Â  Â  Â  Â  Â  Â  to {
Â  Â  Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  Â  Â  Â  Â  transform: translateY(0);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">

Â  Â  <div class="w-full max-w-2xl mx-auto p-4 md:p-8">
Â  Â  Â  Â  <div class="bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl shadow-blue-500/10 flex flex-col">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-6 border-b border-gray-700">
            
            Â  Â  Â  Â  Â  Â  Â  Â  <h1 id="header-title" class="text-2xl font-bold text-center">Steel Forgings CNC Helpdesk</h1>
            
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-400 text-center mt-1">Send a Quick Help request, or type out the issue and we will get back with you ASAP.</p>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="message-container" class="flex-grow p-6 space-y-4 overflow-y-auto h-80 bg-gray-900/50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="message flex items-start gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-blue-500 rounded-full h-8 w-8 flex-shrink-0 flex items-center justify-center font-bold text-sm">I</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold text-gray-300">IT Helpdesk <span class="text-xs text-gray-500 font-normal ml-1">Just now</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-gray-700 p-3 rounded-lg mt-1 text-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Use the buttons below to send an alert to IT, otherwise type a message below with your issue.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-6 border-t border-gray-700 bg-gray-800/80 rounded-b-2xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="send-alert-btn" class="w-full bg-red-600 hover:bg-red-700 transition-all duration-200 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 mb-4 shadow-lg shadow-red-500/20">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Send Quick HELP Request (Mill 20)
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  sÂ  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="message-input" placeholder="Type your message here..." class="flex-grow bg-gray-700 border border-gray-600 rounded-lg py-3 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="send-message-btn" class="bg-blue-600 hover:bg-blue-700 transition-all duration-200 text-white font-bold py-3 px-4 rounded-lg flex-shrink-0 shadow-lg shadow-blue-500/20">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

<script>
Â  Â  Â  Â  const messageContainer = document.getElementById('message-container');
Â  Â  Â  Â  const sendAlertBtn = document.getElementById('send-alert-btn');
Â  Â  Â  Â  const sendMessageBtn = document.getElementById('send-message-btn');
Â  Â  Â  Â  const messageInput = document.getElementById('message-input');
Â  Â  Â  Â Â 
Â  Â  Â  Â  // This will hold our mill ID, e.g., "Mill-20"
Â  Â  Â  Â  let millId = 'Unknown Mill';

Â  Â  Â  Â  // --- NEW: Function to send to our OWN backend ---
Â  Â  Â  Â  async function sendToSlack(message, isAlert = false) {
Â  Â  Â  Â  Â  Â  // Display the message you've sent
Â  Â  Â  Â  Â  Â  addMessageToUI('You', message, 'sent');

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Send to our /api/send endpoint, not Slack
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch('/api/send', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Send the message AND the millId
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message: message,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mill: millId,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isAlert: isAlertÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }),
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Server returned an error.');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Simulate a response
nbsp; Â  Â  Â  Â  Â  Â  simulateSlackResponse(message);

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error(error);
Â  Â  Â  Â  Â  Â  Â  Â  addMessageToUI('System', `Error: Could not send message. ${error.message}`, 'received');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // This simulation function is unchanged
Â  Â  Â  Â  function simulateSlackResponse(originalMessage) {
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const responses = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "We've received your message and will look into it shortly.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Acknowledged. The IT team has been notified.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Thanks for the update. We're on it.",
Â  Â  Â  Â  Â  _ Â  Â  Â  Â  "Got it. An IT member will respond soon."
Â  Â  Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  Â  Â  const randomResponse = responses[Math.floor(Math.random() * responses.length)];
Â  Â  Â  Â  Â  Â  Â  Â  addMessageToUI('IT Helpdesk', randomResponse, 'received');
Â  Â  Â  Â  Â  Â  }, 1500 + Math.random() * 1000); // Respond in 1.5-2.5 seconds
sÂ  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // This UI function is unchanged
Â  Â  Â  Â  function addMessageToUI(sender, text, type) {
Â  Â  Â  Â  Â  Â  const messageWrapper = document.createElement('div');
Â  Â  Â  Â  Â  Â  messageWrapper.className = `message flex items-start gap-3 ${type === 'sent' ? 'flex-row-reverse' : ''}`;
nbsp; Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const avatar = document.createElement('div');
Â  Â  Â  Â  Â  Â  avatar.className = `rounded-full h-8 w-8 flex-shrink-0 flex items-center justify-center font-bold text-sm ${type === 'sent' ? 'bg-indigo-500' : 'bg-blue-500'}`;
Â  Â  Â  Â  Â  Â  avatar.textContent = sender.charAt(0);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const messageContent = document.createElement('div');
Â  Â  Â  Â  Â  Â  messageContent.className = `flex flex-col ${type === 'sent' ? 'items-end' : 'items-start'}`;

Â  Â  Â  Â  Â  Â  const senderP = document.createElement('p');
Â  Â  Â  Â  Â  Â  senderP.className = 'font-semibold text-gray-300';
Â  Â  Â  Â  Â  Â  const timeSpan = document.createElement('span');
Â  Â  Â  Â  Â  Â  timeSpan.className = 'text-xs text-gray-500 font-normal ml-1';
Â  Â  Â  Â  Â  Â  timeSpan.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

Â  Â  Â  Â  Â  Â  if (type === 'sent') {
Â  Â  Â  Â  Â  Â  Â  Â  senderP.textContent = `You `;
Â  Â  Â  t Â  Â  Â  Â  senderP.appendChild(timeSpan);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  senderP.textContent = `${sender} `;
Â  Â  Â  Â  Â  Â  Â  Â  senderP.appendChild(timeSpan);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const textDiv = document.createElement('div');
nbsp; Â  Â  Â  textDiv.className = `p-3 rounded-lg mt-1 ${type === 'sent' ? 'bg-indigo-600' : 'bg-gray-700'}`;
Â  Â  Â  Â  Â  Â  textDiv.textContent = text;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  messageContent.appendChild(senderP);
a Â  Â  Â  Â  messageContent.appendChild(textDiv);

Â  Â  Â  Â  Â  Â  messageWrapper.appendChild(avatar);
Â  Â  Â  Â  Â  Â  messageWrapper.appendChild(messageContent);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  messageContainer.appendChild(messageWrapper);
Â  Â  Â  Â  Â  Â  messageContainer.scrollTop = messageContainer.scrollHeight; // Auto-scroll to bottom
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- NEW: Run this code when the page loads ---
Â  t Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  Â  Â  Â  // Get 'mill' from URL (e.g., ?mill=Mill-20)
Â  Â  Â  Â  Â  Â  millId = urlParams.get('mill') || 'Default Mill';Â 
            
            // --- THIS BLOCK IS UPDATED ---
            const headerTitle = document.getElementById('header-title');
            if (millId !== 'Default Mill') {
                headerTitle.textContent = `${millId} Helpdesk`;
            }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Update the alert button text
Â  Â  Â  Â  Â  Â  sendAlertBtn.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Send Quick HELP Request (${millId})
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- UPDATED: Event Listeners ---
t Â  Â  Â  sendAlertBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  // The message now includes the dynamic millId
Â  Â  Â  Â  Â  Â  const alertMessage = `ðŸš¨ URGENT ALERT! Assistance needed immediately. ðŸš¨`;
Â  Â  Â  Â  Â  Â  sendToSlack(alertMessage, true);
Â  Â  Â  Â  });

Â  Â  Â  Â  sendMessageBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  const message = messageInput.value.trim();
nbsp; Â  Â  Â  Â  if (message) {
Â  Â  Â  Â  Â  Â  Â  Â  sendToSlack(message);
Â  Â  Â  Â  Â  Â  Â  Â  messageInput.value = '';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  messageInput.addEventListener('keydown', (event) => {
Â  Â  Â  Â  Â  Â  if (event.key === 'Enter') {
Â  Â  Â  Â  Â  Â  Â  Â  sendMessageBtn.click();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>